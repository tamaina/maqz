<!DOCTYPE html><html amp><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1"><title>maqzアップデート - aqz/tamaina's Web site</title><!--*
*
* GitHub: https://github.com/joinmisskey
*
*--><link rel="canonical" href="https://a9z.dev/blog/10-update"><link rel="amphtml" href="https://a9z.dev/blog/10-update.amp"><meta name="author" content="aqz / tamaina"><meta name="generator" content="maqz"><meta name="description"><link rel="icon" href="/favicon.ico" type="image/vnd.microsoft.icon"><link rel="apple-touch-icon" href="/files/images/icons/icon-2.svg" sizes="192x192"><link rel="icon" href="/files/images/icons/icon-2.svg" sizes="192x192" type="image/svg+xml"><link rel="apple-touch-icon" href="/files/images/icons/icon-2.png" sizes="512x512"><link rel="icon" href="/files/images/icons/icon-2.png" sizes="512x512" type="image/png"><link rel="manifest" href="/manifest.json"><link rel="alternate" type="application/rss+xml" title="aqz/tamaina's Web site RSS" href="https://a9z.dev/feed.rdf"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website"><meta property="og:title" content="maqzアップデート - aqz/tamaina's Web site"><meta property="og:description" content="joinmisskeyの成果をmaqzに反映しました。"><meta property="og:image" content="https://a9z.dev/files/images/imports/2019/08/P_20190812_134047.jpg"><meta property="og:url" content="https://a9z.dev/blog/10-update"><meta property="og:site_name" content="aqz/tamaina's Web site"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://a9z.dev/files/images/imports/2019/08/P_20190812_134047.jpg"><meta name="twitter:title" content="maqzアップデート - aqz/tamaina's Web site"><meta name="twitter:description" content="joinmisskeyの成果をmaqzに反映しました。"><meta name="twitter:site" content="t_ma1n"><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><script async src="https://cdn.ampproject.org/v0.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"> </script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><style amp-custom>/* oops */</style><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://a9z.dev/blog/10-update"},"headline":"maqzアップデート","image":{"@type":"ImageObject","url":"https://a9z.dev/files/images/imports/2019/08/P_20190812_134047.jpg","height":900,"width":1200},"datePublished":"2019-11-30T06:45:00.000Z","dateModified":"2019-11-30T06:45:00.000Z","author":{"@type":"Person","name":"aqz / tamaina"},"publisher":{"@type":"Organization","name":"aqz/tamaina's Web site","logo":{"@type":"ImageObject","url":"https://a9z.dev/files/images/icons/publisher-2.png","height":60,"width":600}},"description":"joinmisskeyの成果をmaqzに反映しました。"}</script></head><body><amp-sidebar id="sidebar" layout="nodisplay" side="left"><div class="sidebar-inner"><a class="sidebarstyle-h1" href="/">aqz/tamaina's Web site</a><ul class="list-unstyled sidebarstyle-list"><li class="mb-1"><a class="d-block" href="/about-aqz"><div>aqz/tamainaについて</div></a></li><li class="mb-1"><a class="d-block" href="/blog/"><div>Blog</div></a></li><li class="mb-1"><a class="d-block" href="/products/"><div>作ったもの</div></a></li><li class="mb-1"><a class="d-block" href="/maqz/"><div>maqz</div></a></li><li class="mb-1"><a class="d-block" href="/The-Japanese-Web-Fonts/"><div>The Japanese Web Fonts</div></a></li></ul><div class="sidebarstyle-h1">アカウント</div><ul class="list-unstyled sidebarstyle-list"><li><a class="d-block" href="https://c2.a9z.dev/@aqz" target="_blank" rel="noreferrer">@aqz@c2.a9z.dev</a></li><li><a class="d-block" href="https://yuzulia.xyz/@aqz" target="_blank" rel="noreferrer">@aqz@yuzulia.xyz</a></li><li><a class="d-block" href="https://github.com/tamaina" target="_blank" rel="noreferrer"><i class="fa fab github" data-fa-prefix="fab" data-fa-icon-name="github" data-fa-option="{'classes':['fa-fw']}"></i> tamaina</a></li><li><a class="d-block" href="https://twitter.com/t_ma1n" target="_blank" rel="noreferrer"><i class="fa fab twitter" data-fa-prefix="fab" data-fa-icon-name="twitter" data-fa-option="{'classes':['fa-fw']}"></i> t_ma1n <small>うるさくない</small></a></li><li><a class="d-block" href="https://twitter.com/aqz_tmin" target="_blank" rel="noreferrer"><i class="fa fab twitter" data-fa-prefix="fab" data-fa-icon-name="twitter" data-fa-option="{'classes':['fa-fw']}"></i> aqz_tmin <small>多方面 RT多め</small></a></li><li><a class="d-block" href="https://twitter.com/aqzvy" target="_blank" rel="noreferrer"><i class="fa fab twitter" data-fa-prefix="fab" data-fa-icon-name="twitter" data-fa-option="{'classes':['fa-fw']}"></i> aqzvy <small>VTuber方面</small></a></li><li><a class="d-block" href="https://twitter.com/aqzsy" target="_blank" rel="noreferrer"><i class="fa fab twitter" data-fa-prefix="fab" data-fa-icon-name="twitter" data-fa-option="{'classes':['fa-fw']}"></i> aqzsy <small>政治方面</small></a></li><li><a class="d-block" href="https://www.youtube.com/channel/UC2_ujStdw7oU3wW283K1yeA?sub_confirmation=1" target="_blank" rel="noreferrer"><i class="fa fab youtube" data-fa-prefix="fab" data-fa-icon-name="youtube" data-fa-option="{'classes':['fa-fw']}"></i> YouTube</a></li></ul><div class="small text-muted" id="updateTime">Site built at 2020年4月15日 20:25</div></div></amp-sidebar><div id="ampGrid"><div id="nav"><nav class="navbar navbar-light flex-row p-0" id="mainnav"><button class="hamburger" on="tap:sidebar.toggle" aria-label="メニューを開く"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg></button><a class="navbar-brand mx-5" href="/">a9z.dev</a></nav><nav class="bg-transparent" aria-label="breadcrumb" id="breadcrumb"><div class="container-fulid px-1 px-lg-5"><ol class="breadcrumb bg-transparent text-primary my-0 mx-md-5 mx-1 py-1 px-0"><li class="breadcrumb-item"><a class="py-1 text-primary" href="/" aria-label="aqz/tamaina's Web site"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="home" class="svg-inline--fa fa-home fa-w-18 fa-fw" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg></a></li><li class="breadcrumb-item"><a class="py-1 text-primary" href="/blog/">Blog</a></li><li class="breadcrumb-item active"><a class="text-dark font-weight-bold trigger-gototop button-like-anchor" aria-current="page" href="https://a9z.dev/blog/10-update">maqzアップデート</a></li></ol></div></nav></div><div class="padding" id="main"><div class="container py-3 bg-white"><article class="bg-white" id="article_maincontent"><header class="w-100"><h1>maqzアップデート</h1><div class="d-flex flex-wrap small"><div class="mr-2"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="clock" class="svg-inline--fa fa-clock fa-w-16 fa-fw" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></svg><time datetime="2019-11-30T06:45:00.000Z">2019年11月30日(土) 15:45</time></div><div class="mr-2"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="folder-open" class="svg-inline--fa fa-folder-open fa-w-18 fa-fw" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z"></path></svg><span class="badge badge-success md-small">Computer</span> </div><div class="mr-2"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tags" class="svg-inline--fa fa-tags fa-w-20 fa-fw" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"></path></svg>なし</div><address class="mb-0"><a href="https://yuzulia.xyz/@aqz" target="_blank" rel="noopener">Author: aqz</a></address></div></header><section class="pt-2 pb-4"><p><a href="https://join.misskey.page/ja/blog/2019/11/23-1-about-jm" target="_blank" rel="noopener">joinmisskeyでの成果<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16 fa-fw fa-sm" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path></svg></a>をこのサイトを生成している自作ソフト（<a href="../maqz/">maqz</a>）に反映しました。</p><ul><li>URL（パーマリンク）を変更しました。<ul><li>今まで全てindex.htmlで生成していたものを{basename}.htmlで生成するようにしました。<br>Markdownでリンクを追加する時はわざわざ<code class="language-javascript"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span></code>を余分に書いていたのを解消しました。<br>ただし、特にリダイレクト処理等はしていないので検索結果がほぼすべて404という事態に。</li></ul></li><li><code class="language-javascript">pug<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code>で1ページずつ関数を生成していたのを<code class="language-javascript">pug<span class="token punctuation">.</span><span class="token function">compileFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code>を使用しテンプレートごとに関数を生成するようにしたところ、ビルドが早くなりました。<br>もともとこうするべきだったのですが、PugのAPIがよくわからなかったためできていませんでした。</li><li>縮小画像の生成に<a href="https://www.npmjs.com/package/gulp-responsive" target="_blank" rel="noopener">gulp-responsive<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16 fa-fw fa-sm" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path></svg></a>を用いるようにしました。<br>gulp-responsiveは<a href="https://sharp.pixelplumbing.com/en/stable/" target="_blank" rel="noopener">sharp<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="external-link-alt" class="svg-inline--fa fa-external-link-alt fa-w-16 fa-fw fa-sm" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path></svg></a>を使用するので、ImageMagick/GraphicsMagickの依存が解消され、さらにイメージ縮小処理が高速化しました。普段あんまりしないけど。</li><li><code class="language-javascript"><span class="token operator">&lt;</span>picture<span class="token operator">&gt;</span></code>要素および<code class="language-javascript">srcset</code>/<code class="language-javascript">sizes</code>属性を導入し、画像読み込みの高速化をしました。</li><li>Pjaxは要らなさそうなので廃止しました。<br>Pjaxの問題点:<ul><li>Googleの諸々のスクリプトと相性が合わない<ul><li>SPAでも使えないということなのでGoogle先生の方もちょっとどうにかしてよ～という気持ちがあります。</li></ul></li><li>ページ遷移時にしたい処理は新たに登録する必要がある<ul><li>コード量が多くなって処理も複雑になります。</li></ul></li><li>だからといって早くなるわけではない<ul><li>ブラウザもページ遷移にはかなりのチューニングをしているのでそこまで変わりません。</li></ul></li></ul></li><li>ブログにページングを導入しました。</li></ul></section><footer><div class="d-flex flex-wrap my-2 bg-light"><a class="p-3 flex-fill" href="/blog/11-akeome" id="next"><div class="container">次: c2.a9z.devを開設</div></a><a class="p-3 flex-fill" href="/blog/9-tjwf-v7" id="prev"><div class="container">前: The Japanese Web Fonts v7リリース </div></a></div></footer></article></div></div><div class="bg-white" id="footer"><div class="py-3" id="footer_wrap"><div class="container"><div class="d-flex justify-content-between flex-wrap small"><div>© 2018 - 2020 aqz / tamaina</div></div></div></div></div></div><amp-analytics type="googleanalytics"><script type="application/json">{
  "vars": {
    "account": "UA-148331052-1"
  },
  "triggers": {
    "default pageview": {
      "on": "visible",
      "request": "pageview",
      "vars": {
        "title": "maqzアップデート"
      }
    }
  }
}</script></amp-analytics></body></html>